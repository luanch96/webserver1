# ============================================================================
# webserv - Configuración por defecto
# ============================================================================

# ----------------------------------------------------------------------------
# Servidor 1: localhost (Puerto 8080)
# ----------------------------------------------------------------------------
server {
    listen 8080;
    server_name localhost;
    root www;
    index index.html;
    client_max_body_size 1m;
    
    # Páginas de error personalizadas
    error_page 404 /404.html;
    error_page 500 501 502 503 504 /50x.html;
    
    # Location raíz - permite GET y POST
    location / {
        autoindex off;
        allow_methods GET POST;
    }
    
    # Directorio de uploads - permite POST con autoindex (desplegable)
    location /uploads/ {
        root www;
        client_max_body_size 10k;
        allow_methods GET POST;
        autoindex on;  # ✅ Desplegable activado - muestra archivos subidos
    }
    
    # Directorio estático - solo lectura con autoindex
    location /static/ {
        root www;
        allow_methods GET;
        autoindex on;  # ✅ Desplegable activado - muestra archivos estáticos
    }
    
    # CGI scripts - Python y PHP
    location /cgi-bin/ {
        cgi_pass .py /usr/bin/python3;
        cgi_pass .php /usr/bin/php-cgi;
        allow_methods GET POST;
        root www;
        autoindex on;  # ✅ Desplegable para ver scripts CGI
    }
}

# ----------------------------------------------------------------------------
# Servidor 2: test.local (Puerto 8081) - Con autoindex en raíz
# Sin index configurado para que el autoindex funcione correctamente
# ----------------------------------------------------------------------------
server {
    listen 8081;
    server_name test.local;
    root www;
    # Sin index para que el autoindex tenga prioridad
    client_max_body_size 2m;
    
    # Location raíz - permite GET, POST, DELETE con autoindex (desplegable)
    location / {
        autoindex on;  # ✅ Desplegable activado - muestra contenido del directorio www/
        allow_methods GET POST DELETE;
    }
    
    # Directorio de uploads también con autoindex
    location /uploads/ {
        root www;
        allow_methods GET POST DELETE;
        autoindex on;  # ✅ Desplegable activado
    }
    
    # Directorio estático con autoindex
    location /static/ {
        root www;
        allow_methods GET;
        autoindex on;  # ✅ Desplegable activado
    }
}

